<!doctype HTML>
<html>
<head>
    <title>Marker based AR</title>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.2.0/dist/aframe-orbit-controls.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
    <script>
        // Define component which changes visible color of models
        AFRAME.registerComponent('interactable', {
            init: function(){
                let el = this.el;
                let self = this;
                self.trees = [];              
                el.addEventListener("model-loaded", e =>{
                    let tree3D = el.getObject3D('mesh');
                    if (!tree3D){return;}    
                    tree3D.traverse(function(node){
                        if (node.isMesh){   
                          self.trees.push(node);                          
                          //set new color
                          node.material = new THREE.MeshStandardMaterial({color: 0x33aa00});
                        }
                    });
               });
                // Change model color-/intensity when intersected               
                el.addEventListener('raycaster-intersected', e =>{  
                   self.raycaster = e.detail.el;
                   let intersection = self.raycaster.components.raycaster.getIntersection(el);
                  
                   if (intersection.object.material.emissiveIntensity != 0.5){
                     intersection.object.material.emissive = new THREE.Color(0xFFFF00);
                     intersection.object.material.emissiveIntensity = 0.5; 
                   }  
                   else {
                    intersection.object.material.emissiveIntensity = 0.0; 
                   }                  
                });
             }
         });
    </script>
</head>
    <body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs>
      <a-marker preset="hiro" cursor='rayOrigin: mouse;' raycaster="objects: .tree">
          <a-entity
            id="basemap"
            gltf-model="basemap.gltf"
            scale="0.015 0.015 0.015"
            position="0 0 -2"
            rotation="0 0 0"
             >
              <a-text 
                value="Hover over the trees to mark/unmark them."
                scale="70 70 70"
                position= "-150 30 -10"
              >
              </a-text>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-126 0 73"
                rotation="0 0 0"
                interactable
              >
              </a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="115 0 191"
                rotation="0 0 0"
                interactable
              >
              </a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-125 0 80"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="123 0 170.5"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="93.7 0 166"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="92.4 0 146.5"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="68 0 142.5"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="48.3 0 139.4"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="117.8 0 138.6"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="104.6 0 132"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="71.5 0 131"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="67 0 117"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="84 0 114.5"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="109.4 0 112.2"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="29.16 0 110.5"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="4.7 0 109.2"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="64.1 0 74.2"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="79.5 0 72.6"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="112.3 0 65.2"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-0 0 0"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="69.8 0 58.3"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-0 0 0"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="4.1 0 56.4"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="55.6 0 45.9"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="70.3 0 6.1"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="61.4 0 19.9"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="35.8 0 4.8"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="77 0 -21"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="22 0 -13.5"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-0 0 0"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="118.4 0 25.6"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="90.2 0 55.1"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="90.9 0 28.3"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-0 0 0"
                rotation="0 0 0"
                interactable
              ></a-entity>
              <a-entity
                class="tree"
                gltf-model="tree.gltf"
                scale="1 1 1"
                position="-0 0 0"
                rotation="0 0 0"
                interactable
              ></a-entity>
          </a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>